# 管理画面設計

## 目的
- 対象講座・通知・セッション補正などの運用を一元管理する
- 入室/退室の監視と例外対応を迅速に行う

## ロールと権限
- admin: すべての設定/補正/閲覧が可能
- teacher: 講座単位の閲覧/補正（要件に応じて）
- student: 管理画面へのアクセス不可

## 画面構成（案）
- ダッシュボード
- 講座同期
- 対象講座一覧
- 受講者一覧
- セッション管理
- 通知ポリシー
- フォームID管理
- 監査ログ
- システム設定

## 1. ダッシュボード
- 指標: 本日のIN/OUT件数、未退室数、講座数、エラー数
- 状態: 最終同期時刻、直近の同期結果
- 重要通知: 未退室の上位講座/受講者

## 2. 講座同期
- 設定:
  - 同期範囲: ドメイン全体（固定）
  - アーカイブ含む/除外
  - 同期頻度（管理値）
- 操作:
  - 手動同期実行
  - 同期ログの確認（成功/失敗/件数）

## 3. 対象講座一覧
- 一覧項目:
  - 講座名 / Course ID / Classroom URL
  - enabled（対象か）
  - visible（受講者に表示するか）
  - 参加者数（任意）
  - 最終更新
- 操作:
  - Course ID の手動追加（CSV一括は対象外）
  - enabled/visible の切り替え
  - Classroom URL はAPI由来を表示（編集不可）
- ルール:
  - enabled=false でも visible=true にはできない

## 4. 受講者一覧
- 一覧項目:
  - 名前 / メール / 参加講座数 / 未退室数
- 操作:
  - 受講者ごとの通知ポリシー上書き
  - 手動でセッション補正

## 5. セッション管理
- 一覧項目:
  - 受講者 / 講座 / IN / OUT / 状態 / ソース
- 操作:
  - OUT未設定を手動クローズ
  - OUT時刻の補正（日時選択）
  - 補正理由の記録
- ルール:
  - 補正は必ずログに残す

## 6. 通知ポリシー
- グローバル設定:
  - 初回通知までの時間
  - 再通知間隔
  - 最大通知日数
- 上書き:
  - 講座単位 / 受講者単位
- 操作:
  - 有効/無効切り替え
  - テンプレートのプレビュー

## 7. フォームID管理
- 目的: Google Formsの提出時間をOUT補助に使う
- 一覧項目:
  - 講座 / 課題名 / Form ID / 最終取得
- 操作:
  - Form ID の手動登録
  - 無効化/削除

## 8. 監査ログ
- 対象:
  - 管理者による設定変更
  - セッション補正
  - 通知送信
- 検索/フィルタ:
  - 期間 / 管理者 / 対象講座

## 9. システム設定
- OAuth設定の状態（同意画面のメタ）
- 通知チャネルの有効化
- タイムゾーン/表示言語

## UIガイド
- 一覧は必ず検索/フィルタが可能
- 重要操作には確認ダイアログ
- 変更は即時保存、もしくは明示的な保存ボタン
- 失敗時は理由を表示し再試行を促す

## バリデーション
- Course ID は空/重複不可
- Form ID は空/重複不可
- enabled/visible は整合性チェック
- OUT補正は IN より後の時刻のみ許可
