# Classroom Check-in Handoff

最終更新: 2026-02-14 23:15 JST

## 現在のフェーズ

**本番運用中 - 機能完成・安定稼働フェーズ**

## 直近の変更履歴

| 日付 | コミット | 内容 |
|------|----------|------|
| 2026-02-14 | PR #36 | スーパー管理者テナント削除機能追加、ログイン画面リンク整理 |
| 2026-02-14 | PR #35 | レガシールート・API削除、テナントURL未認証リダイレクト修正 |
| 2026-02-10 | 222542d | E2Eテスト修正 - useHeartbeatをテナントAPI対応に変更 |
| 2026-02-10 | b97cc14 | Firestoreエミュレータを使用するテナントE2Eテスト実装（#34） |

## MVP実装状況

| 機能 | 状態 | 備考 |
|------|------|------|
| 入退室打刻 | ✅完了 | IN/OUT、heartbeat |
| 管理画面 | ✅完了 | 講座・受講者・セッション・通知ポリシー管理 |
| 受講者画面 | ✅完了 | 講座一覧、セッションタイマー |
| Firebase認証 | ✅完了 | Googleソーシャルログイン |
| マルチテナント | ✅完了 | URLパスプレフィックス分離 |
| テナント登録 | ✅完了 | セルフサービス |
| スーパー管理者 | ✅完了 | 全テナント管理 |
| OUT忘れ通知 | ✅完了 | 通知サービス、Cloud Scheduler |
| セルフチェックアウト | ✅完了 | 受講者が退室時刻を指定 |
| 再入室禁止 | ✅完了 | 同一講座への再入室ブロック |
| デモモード | ✅完了 | 読み取り専用 |

## 次のアクション候補

1. **パス変換ロジック統一** - `use-authenticated-fetch.ts`と`auth-fetch-context.tsx`のv1→v2変換ロジック重複を解消
2. **ページコンポーネントのAPIパス直接v2化** - `authFetch("/api/v1/...")`をv2パスに書き換え、変換レイヤー削除
3. **新機能検討** - 運用フィードバックに基づく改善

## デプロイ済みインフラ

| サービス | URL |
|----------|-----|
| API | https://api-102013220292.asia-northeast1.run.app |
| Web | https://web-102013220292.asia-northeast1.run.app |
| Notification | https://notification-102013220292.asia-northeast1.run.app |
| Docs | https://system-279.github.io/classroom-check-in/ |

## テスト状況

| サービス | テスト数 | 状態 |
|----------|----------|------|
| API | 314件 | ✅Pass |
| Notification | 20件 | ✅Pass |
| E2E（マルチテナント） | 5件 | ✅Pass |
| 合計 | 339件 | ✅Pass |

## 今回のセッション詳細（2026-02-14 後半）

### 完了した作業

✅ **スーパー管理者テナント削除機能追加（PR #36）**
- API: `DELETE /api/v2/super/tenants/:id` エンドポイント実装
  - `recursiveDelete` で全9サブコレクション含む完全削除
  - 操作ログ記録、404/500エラーハンドリング
- フロントエンド: テナント削除確認ダイアログ新規作成
  - テナントID手入力による誤操作防止
  - 削除ボタンを操作列に追加（赤色）
- テスト: DELETE 3ケース追加（計314件のAPI テスト全パス）

✅ **ログイン画面リンク整理**
- 未ログイン画面: 「組織を登録する」「デモを見る」非表示化
- ログイン後（テナント所属あり）: 同リンク非表示
- ログイン後（テナント未所属）: 引き続き表示（新規ユーザー向け）
- dev mode: リンク引き続き表示

### 変更規模
- 6ファイル変更、新規1ファイル（tenant-delete-dialog.tsx）
- 295行追加、39行削除
- CI/CD: 全テスト✅、ビルド✅、Lint✅

### デプロイ状況
✅ PR #36 マージ（squash）→ main に自動デプロイ完了
- CI: 54秒で成功
- Deploy to Cloud Run: 2m59秒で成功
- GitHub Pages: 自動更新完了

### システム状態
✅ テナント削除機能：本番環境デプロイ済み
✅ スーパー管理者画面で即座に使用可能
✅ ログイン画面UX改善：セッション所属別の適切なリンク表示
✅ 再開可能（コード品質・テスト・ドキュメント整合性確認済み）
